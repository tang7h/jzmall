
<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>{$page_title}</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black" />
<meta name="format-detection" content="telephone=no" />
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<link href="images/touch-icon.png" rel="apple-touch-icon-precomposed" />
<link href="images/favicon.ico" rel="shortcut icon" type="image/x-icon" />
<link href="{$ecs_css_path}" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="js/TouchSlide.js"></script>
</head>
<body>

<style type="text/css">
#allmap {width: 100%;height: 540px;overflow: hidden;margin:0;font-family:"utf-8";float: left;margin-top: -10;}
</style>
<div class="box" style="height: 280px;">
    <h5 style=" padding-bottom: 8px;"><span>我附近的商家</span></h5>
  <div class="boxCenterList" style="padding-left: 0px; padding-right: 0px;padding-bottom: 0px;">
    <div id="allmap"></div>
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=BLuLBrTfuMSF85592olt80FC"></script>
    <script type="text/javascript">
  // 百度地图API功能
  var map = new BMap.Map("allmap");
  //var point = new BMap.Point(116.331398,39.897445);
  var log1='$log'
  var lat="$lat";
  var point = new BMap.Point(log1,lat);
  map.centerAndZoom(point,11);//地图默认放大倍数
  function myFun(result){
    var cityName = result.name;
    map.setCenter(cityName);
/*******************弹窗显示地理位置**************************/
   /* alert("当前定位城市:"+cityName);*/
  }
/*******************结束**************************/
  var myCity = new BMap.LocalCity();
  myCity.get(myFun);
  
  var pointArray = new Array();
  map.enableScrollWheelZoom();   //启用滚轮放大缩小，默认禁用
      map.enableContinuousZoom();    //启用地图惯性拖拽，默认禁用
      //设置需要在地图上显示的点
 var json_data =  {$map_api};
  for(var i=0;i<json_data.length;i++){
    
    //在百度地图上添加想要显示的点的经纬度
    var marker = new BMap.Marker(new BMap.Point(json_data[i][0], json_data[i][1])); // 创建点
    map.addOverlay(marker);    //增加点
    pointArray[i] = new BMap.Point(json_data[i][0], json_data[i][1]);
/*****************增加点击弹窗*********************/
    marker.addEventListener("click",attribute);
    
    /*****************点击弹窗结束*********************/
}
//让所有点在视野范围内
 /* map.setViewport(pointArray);*/
  
   //获取覆盖物位置
  function attribute(e){
    var p = e.target;
      var pointArray =  {$map_api};
      for(var i=0;i<pointArray.length;i++){
        if(pointArray[i][0]==p.getPosition().lng&&p.getPosition().lat==pointArray[i][1]){
              var sContent ="<div>"+
                "<h4 style='margin:0 0 5px 0;padding:0.2em 0'>"+json_data[i][2]+"</h4>" + 
                    "<a href='"+json_data[i][6]+"' target='_blank'>点击进入店铺</a>"+
                "<img style='float:right;margin:4px' id='imgDemo' src='"+json_data[i][3]+"' width='139' height='104' title='"+json_data[i][4]+"'/>" + 
                "<p style='margin:0;line-height:1.5;font-size:13px;text-indent:2em'>"+json_data[i][5]+"</p>" + 
                "</div>";
              var infoWindow = new BMap.InfoWindow(sContent,{enableMessage:false});  // 创建信息窗口对象
              this.openInfoWindow(infoWindow); 
        }
    }

      <!-------------------- 弹窗----------------------> 
    <!-------------------弹窗结束----------------------> 
  
  }
  

    </script>
  </div>
</div>


</body>
</html>
